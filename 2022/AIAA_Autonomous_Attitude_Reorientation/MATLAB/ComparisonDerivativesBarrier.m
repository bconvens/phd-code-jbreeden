function [grad, hess] = ComparisonDerivativesBarrier(q, qr, x1, y1, y2, ctheta1, ctheta2, k)
q0 = q(1); q1 = q(2); q2 = q(3); q3 = q(4);
qr0 = qr(1); qr1 = qr(2); qr2 = qr(3); qr3 = q(4);
x11 = x1(1); x12 = x1(2); x13 = x1(3);
y11 = y1(1); y12 = y1(2); y13 = y1(3);
y21 = y2(1); y22 = y2(2); y23 = y2(3);

% What the paper says to do
% grad = [ - (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)) - ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2);
%    (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2);
%    (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) + ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2);
%    (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)];
% 
% hess = [[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           - (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2) - 2*((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y11 - ctheta1 + x12*y12 + x13*y13))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y21 - ctheta2 + x12*y22 + x13*y23))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13))^2)/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23))^2)/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2), ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 - x13*y12))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 - x13*y22))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 - x13*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 - x13*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) + ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 - x12*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 - x12*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0))];
%     [ ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 - x13*y12))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 - x13*y22))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ((k*(ctheta1 - x11*y11 + x12*y12 + x13*y13))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(ctheta2 - x11*y21 + x12*y22 + x13*y23))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))^2)/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))^2)/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2)*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2) - (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2) + 2*((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)), ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 + x12*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 + x12*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)), ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 + x13*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 + x13*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1))];
%     [ ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 - x13*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 - x13*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) + ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 + x12*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 + x12*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ((k*(ctheta1 + x11*y11 - x12*y12 + x13*y13))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(ctheta2 + x11*y21 - x12*y22 + x13*y23))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12))^2)/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22))^2)/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2)*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2) - (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2) - 2*((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)), ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 + x13*y12))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 + x13*y22))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12))*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22))*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1))];
%     [ ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 - x12*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 - x12*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 + x13*y11))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 + x13*y21))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11))*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21))*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)), ((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 + x13*y12))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 + x13*y22))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12))*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22))*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ((k*(ctheta1 + x11*y11 + x12*y12 - x13*y13))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(ctheta2 + x11*y21 + x12*y22 - x13*y23))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12))^2)/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22))^2)/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2)*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2) - (k*log((q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 - (q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 - (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 - (q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 - (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2) + 2*((k*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/((q1*(q2*(x11*y12 + x12*y11) - q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) + q0*(x12*y13 - x13*y12) + q3*(x11*y13 + x13*y11)))/2 - (q2*(q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) - q1*(x11*y12 + x12*y11) + q0*(x11*y13 - x13*y11) - q3*(x12*y13 + x13*y12)))/2 + (q3*(q0*(x11*y12 - x12*y11) - q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q1*(x11*y13 + x13*y11) + q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) + q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/((q1*(q2*(x11*y22 + x12*y21) - q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) + q0*(x12*y23 - x13*y22) + q3*(x11*y23 + x13*y21)))/2 - (q2*(q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) - q1*(x11*y22 + x12*y21) + q0*(x11*y23 - x13*y21) - q3*(x12*y23 + x13*y22)))/2 + (q3*(q0*(x11*y22 - x12*y21) - q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q1*(x11*y23 + x13*y21) + q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) + q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1))]];

% Compensation for notational issues
grad = [ - (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)) - ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2);
   (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2);
   (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) + ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2);
   (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)];

hess =  [[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y11 - ctheta1 + x12*y12 + x13*y13))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y21 - ctheta2 + x12*y22 + x13*y23))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13))^2)/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23))^2)/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - 2*((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)) - (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2), ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 - x13*y12))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 - x13*y22))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 - x13*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 - x13*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) + ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 - x12*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 - x12*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0))];
    [ ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 - x13*y12))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 - x13*y22))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             2*((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) - ((k*(ctheta1 - x11*y11 + x12*y12 + x13*y13))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(ctheta2 - x11*y21 + x12*y22 + x13*y23))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11))^2)/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21))^2)/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2)*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2) - (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 + x12*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 + x12*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) + ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 + x13*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 + x13*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11))*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21))*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) + ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1))];
    [ ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 - x13*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 - x13*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)) + ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 + x12*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 + x12*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)) + ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           - (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2) - ((k*(ctheta1 + x11*y11 - x12*y12 + x13*y13))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(ctheta2 + x11*y21 - x12*y22 + x13*y23))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))^2)/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))^2)/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2)*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2) - 2*((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 + x13*y12))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 + x13*y22))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) + ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2))];
    [ ((k*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y12 - x12*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y22 - x12*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12))*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22))*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr1*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) + 2*qr2*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) + 2*qr3*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x11*y13 + x13*y11))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x11*y23 + x13*y21))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) + (k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11))*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21))*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) + ((k*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) + ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr1*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr2*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr3*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)), ((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2)*((k*(x12*y13 + x13*y12))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(x12*y23 + x13*y22))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12))*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22))*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2) - ((k*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) + ((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr1*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) - 2*qr2*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1) + 2*qr3*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             2*((k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0*(q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0) + 2*qr1*(q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1) - 2*qr2*(q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2) - 2*qr3*(q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)) - ((k*(ctheta1 + x11*y11 + x12*y12 - x13*y13))/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + (k*(ctheta2 + x11*y21 + x12*y22 - x13*y23))/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2) - (k*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12))^2)/((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2)^2 - (k*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22))^2)/((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2)^2)*((q0*qr0 + q1*qr1 + q2*qr2 + q3*qr3 - 1)^2 + (q0*qr1 - q1*qr0 - q2*qr3 + q3*qr2)^2 + (q0*qr2 - q2*qr0 + q1*qr3 - q3*qr1)^2 + (q0*qr3 - q1*qr2 + q2*qr1 - q3*qr0)^2) - (k*log((q1*(q1*(ctheta1 - x11*y11 + x12*y12 + x13*y13) - q2*(x11*y12 + x12*y11) + q0*(x12*y13 - x13*y12) - q3*(x11*y13 + x13*y11)))/2 - (q2*(q1*(x11*y12 + x12*y11) - q2*(ctheta1 + x11*y11 - x12*y12 + x13*y13) + q0*(x11*y13 - x13*y11) + q3*(x12*y13 + x13*y12)))/2 + (q3*(q3*(ctheta1 + x11*y11 + x12*y12 - x13*y13) + q0*(x11*y12 - x12*y11) - q1*(x11*y13 + x13*y11) - q2*(x12*y13 + x13*y12)))/2 + (q0*(q3*(x11*y12 - x12*y11) - q2*(x11*y13 - x13*y11) + q1*(x12*y13 - x13*y12) - q0*(x11*y11 - ctheta1 + x12*y12 + x13*y13)))/2) + k*log((q1*(q1*(ctheta2 - x11*y21 + x12*y22 + x13*y23) - q2*(x11*y22 + x12*y21) + q0*(x12*y23 - x13*y22) - q3*(x11*y23 + x13*y21)))/2 - (q2*(q1*(x11*y22 + x12*y21) - q2*(ctheta2 + x11*y21 - x12*y22 + x13*y23) + q0*(x11*y23 - x13*y21) + q3*(x12*y23 + x13*y22)))/2 + (q3*(q3*(ctheta2 + x11*y21 + x12*y22 - x13*y23) + q0*(x11*y22 - x12*y21) - q1*(x11*y23 + x13*y21) - q2*(x12*y23 + x13*y22)))/2 + (q0*(q3*(x11*y22 - x12*y21) - q2*(x11*y23 - x13*y21) + q1*(x12*y23 - x13*y22) - q0*(x11*y21 - ctheta2 + x12*y22 + x13*y23)))/2))*(2*qr0^2 + 2*qr1^2 + 2*qr2^2 + 2*qr3^2)]];

end